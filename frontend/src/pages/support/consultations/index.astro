---
import { fetchBackendApi } from "../../../global/api";
import { formatDate } from "../../../global/utils";
import type { Consultation } from "../../../global/types";

import Layout from "../../../layouts/Layout.astro";
import Section from "../../../components/Section/Section.svelte";
import Title from "../../../components/Title.svelte";
import Link from "../../../components/Link.svelte";

const data = await fetchBackendApi<{ results: Consultation[] }>(
  Astro,
  "/api/consultations/",
);
const consultations = data.results;
---

<Layout>
  <Section>
    <Title level={1} text="Consultations" />
    <div class="overflow-x-auto">
      <table class="w-full whitespace-nowrap text-left">
        <thead class="font-bold">
          <tr>
            <th class="py-2 pr-2">name</th>
            <th class="py-2 pr-2">created at</th>
          </tr>
        </thead>
        <tbody>
          {
            consultations.map((consultation) => (
              <tr class="border-t hover:bg-gray-50">
                <td class="py-2 pr-2">
                  <Link href={`/support/consultations/${consultation.id}`}>
                    {consultation.title}
                  </Link>
                </td>
                <td class="py-2 pr-2">{formatDate(consultation.created_at)}</td>
              </tr>
            ))
          }
        </tbody>
      </table>
    </div>
  </Section></Layout
>
