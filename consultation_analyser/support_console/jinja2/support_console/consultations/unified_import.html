{% extends "base.html" %}
{%- from 'govuk_frontend_jinja/components/button/macro.html' import govukButton -%}
{%- from 'govuk_frontend_jinja/components/select/macro.html' import govukSelect -%}
{%- from 'govuk_frontend_jinja/components/input/macro.html' import govukInput -%}
{%- from 'govuk_frontend_jinja/components/details/macro.html' import govukDetails -%}

{% set page_title = "Unified Consultation Import" %}

{% block content %}
<h1 class="govuk-heading-l">{{ page_title }}</h1>

<p class="govuk-body-l">Import complete consultation data including AI analysis in one operation.</p>
<p class="govuk-body">This will import both the consultation data (questions, respondents, responses) and AI analysis results (themes, sentiment, evidence) sequentially.</p>

<p class="govuk-body">Data should be saved in: <code>{{ bucket_name }}/app_data/[CONSULTATION FOLDER]</code></p>

{{ govukDetails({
  'summaryText': 'Expected S3 Structure',
  'html': '
    <pre><code>&lt;consultation-folder&gt;/
├── inputs/
│   ├── respondents.jsonl
│   ├── question_part_1/
│   │   ├── question_part.json
│   │   └── responses.jsonl
│   └── question_part_2/
│       ├── question_part.json
│       └── responses.jsonl
└── outputs/
    └── mapping/
        └── &lt;timestamp&gt;/
            ├── question_part_1/
            │   ├── themes.json
            │   ├── sentiment.jsonl
            │   ├── detail_detection.jsonl
            │   └── mapping.jsonl
            └── question_part_2/
                ├── themes.json
                ├── sentiment.jsonl
                ├── detail_detection.jsonl
                └── mapping.jsonl</code></pre>
  '
}) }}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <form method="post" novalidate>{{ csrf_input }}
      
      {{ govukInput({
        'id': 'consultation_name',
        'name': 'consultation_name',
        'label': {
          'text': 'Consultation title',
          'classes': 'govuk-label--s'
        },
        'classes': 'govuk-input--width-30'
      }) }}

      {{ govukSelect({
        'id': 'consultation_code',
        'name': 'consultation_code',
        'label': {
          'text': 'Select consultation folder',
          'classes': 'govuk-label--s'
        },
        'items': consultation_folders
      }) }}

      {{ govukInput({
        'id': 'timestamp',
        'name': 'timestamp',
        'label': {
          'text': 'Mapping timestamp folder',
          'classes': 'govuk-label--s'
        },
        'hint': {
          'text': 'e.g., 2024-01-15-14-30-00'
        },
        'classes': 'govuk-input--width-20'
      }) }}

      {{ govukButton({
        'text': 'Import Complete Consultation',
        'classes': 'govuk-button--primary'
      }) }}
    </form>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <h2 class="govuk-heading-m">Import Progress</h2>
    <p class="govuk-body">Check the <a href="/support/django-rq/" class="govuk-link">Django RQ dashboard</a> to monitor import progress.</p>
  </div>
</div>

{% endblock %}